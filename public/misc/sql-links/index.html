<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

  
  <script>
    !function(){var i="analytics",analytics=window[i]=window[i]||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","screen","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware","register"];analytics.factory=function(e){return function(){if(window[i].initialized)return window[i][e].apply(window[i],arguments);var n=Array.prototype.slice.call(arguments);if(["track","screen","alias","group","page","identify"].indexOf(e)>-1){var c=document.querySelector("link[rel='canonical']");n.push({__t:"bpc",c:c&&c.getAttribute("href")||void 0,p:location.pathname,u:location.href,s:location.search,t:document.title,r:document.referrer})}n.unshift(e);analytics.push(n);return analytics}};for(var n=0;n<analytics.methods.length;n++){var key=analytics.methods[n];analytics[key]=analytics.factory(key)}analytics.load=function(key,n){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.setAttribute("data-global-segment-analytics-key",i);t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r);analytics._loadOptions=n};analytics._writeKey="pynCOJpnnC6lmdYBIC5Xb7KUWRl16bOp";;analytics.SNIPPET_VERSION="5.2.0";
    analytics.load("pynCOJpnnC6lmdYBIC5Xb7KUWRl16bOp");
    analytics.page();
    }}();
  </script>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="üóÑÔ∏èüîç database design &amp; SQL links
SQL Online Learning Resources

Kaggle&rsquo;s Intro to SQL
Kaggle&rsquo;s Advanced SQL
Snowflake&rsquo;s Data Warehousing Workshop
Mode&rsquo;s SQL Tutorial

Snowflake Links


Resource Optimization: Performance


Resource Optimization: Usage Monitoring


Resource Optimization: Billing Metrics


Clever way to join information_schema tables to query_history


Good article explaining Snowflake credit usage


ODBC Configuration and Connection Parameters


Snowflake Cost Management Links

Track Materialized Views
Lower Auto-Suspend
How Snowflake cache works
Understand auto-suspension
sample github snowflake monitoring queries
Apply tags from dbt

Snowflake Cheat Sheet
Functions
NVL2 - Return values depending if first value is null.">  

  <title>
    
      
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="https://javiersalazar.info:1313/" />
  
  
  
  <link rel="stylesheet" href="https://javiersalazar.info:1313/css/main.01273a70fa873b012d056499c16bb47955e0e7526c34edb73f05ca8f99f488ebc323423c6557f93f9b42a41de0448a25ce9a1ab577d0bf61e36eaf52a4979a1d.css" integrity="sha512-ASc6cPqHOwEtBWSZwWu0eVXg51JsNO23PwXKj5n0iOvDI0I8ZVf5P5tCpB3gRIolzpoatXfQv2Hjbq9SpJeaHQ==" />
  

  <link rel="stylesheet" href="https://javiersalazar.info:1313/css/custom.css">
</head>
<body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="https://javiersalazar.info:1313/">..</a>


<article>
    <p class="post-meta">
        <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">
            0001-01-01
        </time>
    </p>

    <h1></h1>

    

    <h1 id="-database-design--sql-links">üóÑÔ∏èüîç database design &amp; SQL links</h1>
<h2 id="sql-online-learning-resources">SQL Online Learning Resources</h2>
<ul>
<li><a href="https://www.kaggle.com/learn/intro-to-sql">Kaggle&rsquo;s Intro to SQL</a></li>
<li><a href="https://www.kaggle.com/learn/advanced-sql">Kaggle&rsquo;s Advanced SQL</a></li>
<li><a href="https://learn.snowflake.com/en/courses/uni-essdww101/">Snowflake&rsquo;s Data Warehousing Workshop</a></li>
<li><a href="https://mode.com/sql-tutorial/">Mode&rsquo;s SQL Tutorial</a></li>
</ul>
<h2 id="snowflake-links">Snowflake Links</h2>
<ul>
<li>
<p><a href="https://quickstarts.snowflake.com/guide/resource_optimization_performance_optimization/index.html?index=..%2F..index#0">Resource Optimization: Performance</a></p>
</li>
<li>
<p><a href="https://quickstarts.snowflake.com/guide/resource_optimization_usage_monitoring/index.html?index=..%2F..index#0">Resource Optimization: Usage Monitoring</a></p>
</li>
<li>
<p><a href="https://quickstarts.snowflake.com/guide/resource_optimization_billing_metrics/index.html?index=..%2F..index#0">Resource Optimization: Billing Metrics</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/70585936/how-to-get-a-list-of-tables-used-for-each-query-in-the-query-history-in-snowflak/70589299#70589299">Clever way to join <code>information_schema</code> tables to <code>query_history</code></a></p>
</li>
<li>
<p><a href="https://medium.com/snowflake/mythbusting-snowflake-pricing-all-the-cool-stuff-you-get-with-1-credit-f3daad217a98">Good article explaining Snowflake credit usage</a></p>
</li>
<li>
<p><a href="https://docs.snowflake.com/en/developer-guide/odbc/odbc-parameters">ODBC Configuration and Connection Parameters</a></p>
</li>
</ul>
<h3 id="snowflake-cost-management-links">Snowflake Cost Management Links</h3>
<ul>
<li><a href="https://docs.snowflake.com/en/user-guide/views-materialized#label-materialized-views-maintenance-billing">Track Materialized Views</a></li>
<li><a href="https://docs.snowflake.com/en/user-guide/warehouses-overview#auto-suspension-and-auto-resumption">Lower Auto-Suspend</a></li>
<li><a href="https://community.snowflake.com/s/article/Caching-in-Snowflake-Data-Warehouse">How Snowflake cache works</a></li>
<li><a href="https://docs.snowflake.com/en/user-guide/warehouses-overview#auto-suspension-and-auto-resumption">Understand auto-suspension</a></li>
<li><a href="https://github.com/seanrm42/snowflake_scripts/tree/main/5_monitoring">sample github snowflake monitoring queries</a></li>
<li><a href="https://docs.getdbt.com/reference/resource-configs/snowflake-configs#query-tags">Apply tags from dbt</a></li>
</ul>
<h1 id="snowflake-cheat-sheet">Snowflake Cheat Sheet</h1>
<h3 id="functions">Functions</h3>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/nvl2.html">NVL2</a> - Return values depending if first value is null.</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/array_agg.html">ARRAY_AGG</a> - Returns inputs pivoted into an array.</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/constructs/pivot.html">PIVOT</a> - Transform narrow table to wider table by expanding dimensions to columns.</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/constructs/values.html">VALUES</a> - Select from constant values</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/generator.html">GENERATOR</a> - Creates rows of data based either on a specified number of rows</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/constructs/connect-by.html">CONNECT BY</a> - Joins a table to itself recursively</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/any_value">ANY_VALUE</a> - Returns non-deterministic value as an aggregate or window function</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/object_keys">OBJECT_KEYS</a> - Returns array of the top level of json object</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/encrypt">ENCRYPT</a> - Encrypts values with a passphrase</p>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/decrypt">DECRYPT</a> - Decrypts values with a passphrase, add <code>to_varchar([value], ‚Äòutf-8‚Äô)</code></p>
<p><a href="https://docs.snowflake.com/en/sql-reference/functions/system_clustering_information">SYSTEM$CLUSTERING_INFORMATION</a> - Returns clustering information</p>
<h2 id="useful-examples">useful examples</h2>
<h3 id="clustering">Clustering</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SYSTEM</span><span style="color:#960050;background-color:#1e0010">$</span>CLUSTERING_INFORMATION( <span style="color:#e6db74">&#39;&lt;table_name&gt;&#39;</span>
</span></span><span style="display:flex;"><span>    [ , <span style="color:#960050;background-color:#1e0010">{</span> <span style="color:#e6db74">&#39;( &lt;expr1&gt; [ , &lt;expr2&gt; ... ] )&#39;</span> <span style="color:#f92672">|</span> <span style="color:#f92672">&lt;</span>number_of_errors<span style="color:#f92672">&gt;</span> <span style="color:#960050;background-color:#1e0010">}</span> ] )
</span></span></code></pre></div><p>Example</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">SYSTEM</span><span style="color:#960050;background-color:#1e0010">$</span>CLUSTERING_INFORMATION(<span style="color:#e6db74">&#39;models.staging.transactions&#39;</span>, <span style="color:#e6db74">&#39;(date_trunc(day, CREATED_AT_LOCAL))&#39;</span>)
</span></span></code></pre></div><h4 id="pivot-without-using-pivot-example-herehttpsmediumcomsnowflakepivot-anything-in-snowflake-without-the-sql-pivot-function-ba030dce8dfc">Pivot without using pivot <a href="https://medium.com/snowflake/pivot-anything-in-snowflake-without-the-sql-pivot-function-ba030dce8dfc">example here</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>    parsed:project_name::string <span style="color:#e6db74">&#34;project&#34;</span>,
</span></span><span style="display:flex;"><span>    parsed:<span style="color:#e6db74">&#34;project mgr&#34;</span>::string <span style="color:#e6db74">&#34;project mgr&#34;</span>,
</span></span><span style="display:flex;"><span>    parsed:<span style="color:#e6db74">&#34;chief architect&#34;</span>::string <span style="color:#e6db74">&#34;chief architect&#34;</span>,
</span></span><span style="display:flex;"><span>    parsed:<span style="color:#e6db74">&#34;dba&#34;</span>::string <span style="color:#e6db74">&#34;dba&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span>
</span></span><span style="display:flex;"><span>    (   <span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>            parse_json(proj_roles) parsed
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">from</span>
</span></span><span style="display:flex;"><span>            (   <span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>                    concat(<span style="color:#e6db74">&#39;{&#39;</span>, concat(<span style="color:#e6db74">&#39;&#34;project_name&#39;</span>,<span style="color:#e6db74">&#39;&#34;:&#34;&#39;</span>,project_name,<span style="color:#e6db74">&#39;&#34;,&#39;</span>, listagg(concat(<span style="color:#e6db74">&#39;&#34;&#39;</span>
</span></span><span style="display:flex;"><span>                    ,project_role, <span style="color:#e6db74">&#39;&#34;:&#39;</span>,<span style="color:#e6db74">&#39;&#34;&#39;</span>,person,<span style="color:#e6db74">&#39;&#34;&#39;</span>),<span style="color:#e6db74">&#39;,&#39;</span>) ),<span style="color:#e6db74">&#39;}&#39;</span>)proj_roles
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">from</span>
</span></span><span style="display:flex;"><span>                    (   <span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>                            project_name,
</span></span><span style="display:flex;"><span>                            project_role,
</span></span><span style="display:flex;"><span>                            person
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">from</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;project_mgmt&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span>
</span></span><span style="display:flex;"><span>                    project_name));
</span></span></code></pre></div><h4 id="parsing-email-domains">Parsing email domains</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>SPLIT(email_address, <span style="color:#e6db74">&#39;@&#39;</span>)[SAFE_OFFSET(<span style="color:#ae81ff">1</span>)]
</span></span></code></pre></div><h4 id="convert-date-time-to-readable-clock-time">Convert date time to readable clock time</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>to_char(<span style="color:#960050;background-color:#1e0010">{</span>datetime_field<span style="color:#960050;background-color:#1e0010">}</span>, <span style="color:#e6db74">&#39;HH12:MIPM&#39;</span>)
</span></span></code></pre></div><h4 id="generator-example-to-create-365-days-into-the-future-neat">Generator example to create 365 days into the future. Neat.</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>  dateadd(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">day</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">||</span> row_number() over (<span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">null</span>),
</span></span><span style="display:flex;"><span>    dateadd(<span style="color:#66d9ef">day</span>, <span style="color:#e6db74">&#39;+1&#39;</span>, <span style="color:#66d9ef">current_date</span>())
</span></span><span style="display:flex;"><span>  ) <span style="color:#66d9ef">as</span> date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> (generator(rowcount <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">365</span>))
</span></span></code></pre></div><h4 id="how-to-overwrite-nulls-using-window-function">How to overwrite Nulls using window function</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> 
</span></span><span style="display:flex;"><span>	c1, 
</span></span><span style="display:flex;"><span>	coalesce(c2, 
</span></span><span style="display:flex;"><span>		first_value(c2) over (partition <span style="color:#66d9ef">by</span> c1 <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> c2 nulls <span style="color:#66d9ef">last</span>)
</span></span><span style="display:flex;"><span>		) <span style="color:#66d9ef">as</span> c2
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">from</span> (<span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;one&#39;</span>), (<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">null</span>)) <span style="color:#66d9ef">as</span> v1 (c1, c2);
</span></span></code></pre></div><h4 id="nvl2-example">NVL2 example</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>NVL2( <span style="color:#f92672">&lt;</span>expr1<span style="color:#f92672">&gt;</span> , <span style="color:#f92672">&lt;</span>expr2<span style="color:#f92672">&gt;</span> , <span style="color:#f92672">&lt;</span>expr3<span style="color:#f92672">&gt;</span> )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> expr1 <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>, <span style="color:#66d9ef">then</span> NVL2 <span style="color:#66d9ef">returns</span> expr2.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> expr1 <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">NULL</span>, <span style="color:#66d9ef">then</span> NVL2 <span style="color:#66d9ef">returns</span> expr3.
</span></span></code></pre></div><h4 id="convert-utc-to-local">Convert UTC to Local</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>src.createdat::timestamp_ntz <span style="color:#66d9ef">as</span> created_at_utc,
</span></span><span style="display:flex;"><span>convert_timezone(<span style="color:#e6db74">&#39;UTC&#39;</span>, <span style="color:#e6db74">&#39;America/Los_Angeles&#39;</span>, created_at_utc) <span style="color:#66d9ef">as</span> created_at_local,
</span></span></code></pre></div><h4 id="lateral-flatten">Lateral Flatten</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;ID&#34;</span>,
</span></span><span style="display:flex;"><span>   f.value <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;Contact&#34;</span>,
</span></span><span style="display:flex;"><span>   f1.value:<span style="color:#66d9ef">type</span> <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;Type&#34;</span>,
</span></span><span style="display:flex;"><span>   f1.value:content <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;Details&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">from</span> persons p,
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">lateral</span> flatten(<span style="color:#66d9ef">input</span> <span style="color:#f92672">=&gt;</span> p.<span style="color:#66d9ef">c</span>, path <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;contact&#39;</span>) f,
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">lateral</span> flatten(<span style="color:#66d9ef">input</span> <span style="color:#f92672">=&gt;</span> f.value:business) f1;
</span></span></code></pre></div>
</article>

            </div>
        </main>
    </body>
</html>
